set(PARAC_EXECUTABLE_SRCS
    # Generated by distrac
    ${CMAKE_CURRENT_BINARY_DIR}/../distrac_paracooba.h

    ${CMAKE_CURRENT_SOURCE_DIR}/main.cpp
    ${CMAKE_CURRENT_SOURCE_DIR}/CLI.cpp)

add_library(parac_executable OBJECT ${PARAC_EXECUTABLE_SRCS})
set_property(TARGET parac_executable PROPERTY CMAKE_C_VISIBILITY_PRESET default)
set_property(TARGET parac_executable PROPERTY CMAKE_CXX_VISIBILITY_PRESET default)

set_property(TARGET parac_executable PROPERTY POSITION_INDEPENDENT_CODE ON)
set_target_properties(parac_executable PROPERTIES CXX_STANDARD 17)
target_compile_definitions(parac_executable PRIVATE "-DPARAC_LOG_INCLUDE_FMT")
target_link_libraries(parac_executable PUBLIC distrac parac_modules Boost::filesystem Boost::coroutine Boost::context Boost::program_options ${CMAKE_DL_LIBS} fmt parac_loader)
target_include_directories(parac_executable PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/../include)
target_include_directories(parac_executable PRIVATE ${CMAKE_CURRENT_BINARY_DIR}/../)

add_dependencies(parac_executable distrac distrac-codegen)

add_custom_command(
    OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/../distrac_paracooba.h
    MAIN_DEPENDENCY ${CMAKE_CURRENT_BINARY_DIR}/../../Paracooba.distracdef
    COMMAND ${CMAKE_BINARY_DIR}/third_party/distrac/distrac-codegen  ${CMAKE_CURRENT_BINARY_DIR}/../../Paracooba.distracdef -o ${CMAKE_CURRENT_BINARY_DIR}/../distrac_paracooba.h
    DEPENDS distrac)
